<!DOCTYPE html>
<html lang="uk">
<head>
    {{> head}}
</head>
<body>

{{> badge}}
{{> nav}}
{{> avatarframes}}
{{> profilethemes}}

<section class="profile-section">
    <div class="container">
        <div class="profile-header theme-{{#if user.Customer.profile_theme}}{{user.Customer.profile_theme}}{{else}}default{{/if}}">
            <div class="profile-info">
                <div class="profile-avatar-large">
                    {{#if user.Customer.avatar_frame}}
                        <svg class="frame-overlay" viewBox="0 0 140 140">
                            <use href="#frame-{{user.Customer.avatar_frame}}"></use>
                        </svg>
                    {{/if}}

                    {{#if user.Customer.avatar_data}}
                        <img src="{{user.Customer.avatar_data}}" alt="{{user.username}}">
                    {{else}}
                        <span id="profileInitials">{{substring user.username 0 2}}</span>
                    {{/if}}
                </div>
                <div class="profile-details">
                    <h1 id="profileUsername">{{user.username}}</h1>
                    <p class="profile-email">{{user.Customer.email}}</p>
                    <div class="level-progress-container">
                        <div class="level-bar-row">
                            <div class="level-content-wrapper">
                                <div class="level-info">
                                    <span class="level-label">–†—ñ–≤–µ–Ω—å {{gamification.level}}</span>
                                    <span class="level-xp">
                                        {{gamification.experience}} XP
                                        {{#if gamification.nextLevelXp}}
                                            / {{gamification.nextLevelXp}} XP
                                        {{else}}
                                            (–ú–∞–∫—Å. —Ä—ñ–≤–µ–Ω—å!)
                                        {{/if}}
                                    </span>
                                </div>
                                <div class="level-progress-bar">
                                    <div class="level-progress-fill" style="width: {{gamification.progressPercent}}%"></div>
                                </div>
                            </div>
                            <a href="/gamification-info" class="xp-info-link" title="–î—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                                –Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ XP?
                            </a>
                        </div>
                    </div>

                    <div class="profile-stats-inline">
                        <div class="stat-item">
                            <svg class="stat-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span><strong>{{stats.total}}</strong> –∫—É—Ä—Å—ñ–≤</span>
                        </div>
                        <div class="stat-item">
                            <svg class="stat-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span><strong>{{stats.completed}}</strong> –∑–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                        </div>
                        <div class="stat-item">
                            <svg class="stat-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M9 12h6m-6 4h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span><strong>{{stats.quizzesPassed}}</strong> —Ç–µ—Å—Ç—ñ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ</span>
                        </div>
                        <div class="stat-item">
                            <svg class="stat-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M4 22h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M18 2H6v7a6 6 0 0 0 12 0V2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span><strong>{{gamification.badgeCount}}</strong> –±–µ–π–¥–∂—ñ–≤</span>
                        </div>
                        <div class="stat-item">
                            <svg class="stat-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="2"/>
                                <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <span><strong>{{userCoins}}</strong> –º–æ–Ω–µ—Ç ü™ô</span>
                        </div>
                    </div>
                </div>
            </div>
            <button class="btn btn-secondary" onclick="location.href='/settings'">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</button>
        </div>

        <div class="badges-section glass">
            <div class="badges-header">
                <h3 class="section-title">–î–æ—Å—è–≥–Ω–µ–Ω–Ω—è</h3>
            </div>

            {{#if gamification.badges.length}}
                <div class="badges-grid">
                    {{#each gamification.badges}}
                        <div class="badge-item" title="{{this.description}}">
                            <svg class="badge-icon" width="80" height="80">
                                <use href="#{{this.icon}}"></use>
                            </svg>
                            <p class="badge-name">{{this.name}}</p>
                        </div>
                    {{/each}}
                </div>
            {{else}}
                <div class="empty-state" style="padding: 20px;">
                    <p style="color: var(--text-muted); margin: 0;">–ü–æ–∫–∏ —â–æ –¥–æ—Å—è–≥–Ω–µ–Ω—å –Ω–µ–º–∞—î.</p>
                </div>
            {{/if}}
        </div>

        <div class="inventory-section glass" style="margin-top: 30px;">
            <div class="inventory-header">
                <h3 class="section-title">–ú–æ—ó –ø—Ä–µ–¥–º–µ—Ç–∏</h3>
                <a href="/shop" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    –ú–∞–≥–∞–∑–∏–Ω
                </a>
            </div>
            {{#if inventory.length}}
                <div class="inventory-grid">
                    {{#each inventory}}
                        <div class="inventory-item {{#if this.is_equipped}}equipped{{/if}}" data-item-id="{{this.item_id}}" data-type="{{this.item.item_type}}">                            <div class="item-preview">
                                {{#ifCond this.item.item_type '==' 'avatar_frame'}}
                                    <div class="item-preview-container">
                                        <div class="preview-avatar-box">
                                            <div class="dummy-avatar">
                                                {{#if ../user.Customer.avatar_data}}
                                                    <img src="{{../user.Customer.avatar_data}}" class="dummy-img">
                                                {{else}}
                                                    <div class="dummy-placeholder"></div>
                                                {{/if}}
                                            </div>
                                            <svg class="inventory-frame-overlay" viewBox="0 0 140 140">
                                                <use href="#frame-{{this.item.item_value}}"></use>
                                            </svg>
                                        </div>
                                    </div>
                                {{/ifCond}}
                                {{#ifCond this.item.item_type '==' 'profile_theme'}}
                                    <div class="item-preview-container">
                                        <svg class="inventory-theme-preview" viewBox="0 0 140 140">
                                            <use href="#theme-{{this.item.item_value}}"></use>
                                        </svg>
                                    </div>
                                {{/ifCond}}

                                {{#ifCond this.item.item_type '==' 'title_badge'}}
                                    <div class="item-placeholder">üè∑Ô∏è</div>
                                {{/ifCond}}
                                {{#ifCond this.item.item_type '==' 'course_unlock'}}
                                    <div class="item-placeholder">üìö</div>
                                {{/ifCond}}

                                {{#if this.is_equipped}}
                                    <div class="equipped-badge">–ù–∞–¥—è–≥–Ω—É—Ç–æ</div>
                                {{/if}}
                            </div>
                            <div class="item-info">
                                <h4 class="item-name">{{this.item.name}}</h4>
                                <p class="item-description">{{this.item.description}}</p> <span class="item-rarity rarity-{{this.item.rarity}}">{{this.item.rarity}}</span>
                            </div>

                            <div class="item-actions">
                                {{#if this.is_equipped}}
                                    <button class="btn-item-action btn-unequip" onclick="unequipItem({{this.item_id}})">
                                        –ó–Ω—è—Ç–∏
                                    </button>
                                {{else}}
                                    <button class="btn-item-action btn-equip" onclick="equipItem({{this.item_id}})">
                                        –ù–∞–¥—è–≥—Ç–∏
                                    </button>
                                {{/if}}
                            </div>
                        </div>
                    {{/each}}
                </div>
            {{else}}
                <div class="empty-state">
                    <div class="empty-icon">üì¶</div>
                    <h3>–Ü–Ω–≤–µ–Ω—Ç–∞—Ä –ø–æ—Ä–æ–∂–Ω—ñ–π</h3>
                    <p>–í—ñ–¥–≤—ñ–¥–∞–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω, —â–æ–± –ø—Ä–∏–¥–±–∞—Ç–∏ –∫–æ—Å–º–µ—Ç–∏—á–Ω—ñ –ø—Ä–µ–¥–º–µ—Ç–∏!</p>
                    <a href="/shop" class="btn btn-primary" style="margin-top: 20px;">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –º–∞–≥–∞–∑–∏–Ω—É</a>
                </div>
            {{/if}}
        </div>

        <div class="courses-section glass" style="margin-top: 30px;">
            <div class="courses-header">
                <h3 class="section-title">–ú–æ—ó –∫—É—Ä—Å–∏</h3>
            </div>

            <div class="courses-grid" id="coursesGrid">
                {{#each progress}}
                    <div class="course-progress-card glass">
                        <div class="course-header">
                            <div class="course-icon-small">
                                {{{getCourseIcon this.course.category this.course.slug this.course.title}}}
                            </div>
                            <div class="course-badge {{#if this.isFinished}}completed{{else}}in_progress{{/if}}">
                                {{#if this.isFinished}}–ó–∞–≤–µ—Ä—à–µ–Ω–æ{{else}}–í –ø—Ä–æ—Ü–µ—Å—ñ{{/if}}
                            </div>
                        </div>

                        <h3 class="course-name">{{this.course.title}}</h3>
                        <p class="course-progress-text">{{this.completedCount}} –∑ {{this.totalLessons}} —É—Ä–æ–∫—ñ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</p>

                        <div class="progress-bar-container">
                            <div class="progress-bar-fill {{#if this.isFinished}}completed{{/if}}" style="width: {{this.percent}}%"></div>
                        </div>

                        <div class="course-meta-small" style="margin-bottom: 10px;">
                            <span>‚è±Ô∏è {{this.completedHours}}/{{this.totalHours}} –≥–æ–¥</span>
                            <span class="progress-percent">{{this.percent}}%</span>
                        </div>

                        <div class="course-actions-stack" style="display: flex; flex-direction: column; gap: 10px; margin-top: 5px;">
                            <button class="btn {{#if this.isFinished}}btn-secondary{{else}}btn-primary{{/if}} btn-continue"
                                    onclick="location.href='/course/{{this.course.slug}}'">
                                {{#if this.isFinished}}–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫—É—Ä—Å{{else}}–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è{{/if}}
                            </button>

                            <button class="btn btn-primary {{#unless this.isFinished}}btn-disabled{{/unless}}"
                                    {{#unless this.isFinished}}disabled{{/unless}}
                                    onclick="window.location.href='/certificate?course={{this.course_id}}'">
                            –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç
                            </button>
                        </div>
                    </div>
                {{else}}
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üìö</div>
                        <h3>–í–∏ —â–µ –Ω–µ —Ä–æ–∑–ø–æ—á–∞–ª–∏ –∂–æ–¥–Ω–æ–≥–æ –∫—É—Ä—Å—É</h3>
                        <button class="btn btn-primary" onclick="location.href='/courses'">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É</button>
                    </div>
                {{/each}}
            </div>
        </div>
    </div>
</section>

{{> footer}}

<script src="/js/profile.js"></script>
</body>
</html>